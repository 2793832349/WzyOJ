import{z as V,y as z,r as c,s as i,A as w,o as d,G as x,m as b,n as e,w as a,l as y,L as _,Q as I,J as v,C as f,t as E,H as D,D as P,E as M,aA as R}from"./index.eb4377b0.1766986584207.js";import{p as j,t as G,m as H,s as J,l as Q}from"./consts.72579ead.1766986584207.js";import{_ as K}from"./Transfer.f013d8b6.1766986584207.js";import{_ as W}from"./Popconfirm.e2002990.1766986584207.js";import{_ as X}from"./Form.f0be8e2f.1766986584207.js";import{_ as Y}from"./Input.4c626101.1766986584207.js";import{_ as Z}from"./FormItem.d0d13dbd.1766986584207.js";import{_ as ee}from"./Divider.97fa3e74.1766986584207.js";import{_ as ae}from"./Select.324054db.1766986584207.js";import"./Eye.1e3444f4.1766986584207.js";import"./Checkbox.7ca0c7f4.1766986584207.js";import"./Tag.ff1efa14.1766986584207.js";const le=b("h1",null,"\u7528\u6237\u4FE1\u606F",-1),se={key:1},te=b("h1",null,"\u4FEE\u6539\u5BC6\u7801",-1),ne={key:2},oe=b("h1",null,"\u9875\u9762\u8BBE\u7F6E",-1),ue=b("p",null,"\u4EE5\u4E0B\u8BBE\u7F6E\u4FDD\u5B58\u5728\u672C\u5730\u7F13\u5B58\u4E2D\uFF0C\u4E0D\u4F1A\u540C\u6B65\u5230\u4E91\u7AEF\u3002",-1),ke={__name:"settings",setup(re){const L=V(),k=z(),o=c(L.params.id),t=c(o.value?{}:{email:i.state.user.email,avatar:i.state.user.avatar,real_name:i.state.user.real_name});o.value?w.get(`/user/${o.value}/`).then(u=>{t.value=u}):w.get("/user/info/").then(u=>{t.value=u,i.commit("setUser",u)});const O=()=>{let u;o.value?u=w.put(`/user/${o.value}/`,t.value):u=w.put("/user/info/",t.value),u.then(l=>{k.success("\u4FDD\u5B58\u6210\u529F"),o||i.commit("setUser",l)})},T=()=>{w.delete(`/user/${o.value}/`).then(()=>{k.success("\u5220\u9664\u6210\u529F\uFF01"),P.push({name:"user_list"})})},r=c({old_password:"",new_password:"",confirm_password:""}),$=c({old_password:[{required:!0,message:"\u8BF7\u8F93\u5165\u65E7\u5BC6\u7801"}],new_password:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"}],confirm_password:[{required:!0,message:"\u8BF7\u786E\u8BA4\u5BC6\u7801",validator:(u,l)=>l!==r.value.new_password?Promise.reject("\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4"):Promise.resolve()}]}),q=()=>{w.post("/user/change_password/",{old_password:r.value.old_password,new_password:r.value.new_password}).then(u=>{k.success("\u4FEE\u6539\u6210\u529F"),P.push({name:"login"})})},p=c({...i.state.displaySettings}),B=()=>{i.commit("setDisplaySettings",p.value),k.success("\u4FDD\u5B58\u6210\u529F")},F=()=>{i.commit("setDisplaySettings",D.displaySettings),window.location.reload()};return(u,l)=>{const m=Y,n=Z,N=K,g=M,S=W,A=R,h=X,C=ee,U=ae;return d(),x(I,null,[b("div",null,[le,e(h,{model:t.value,style:{"max-width":"min(100%, 500px)"}},{default:a(()=>[o.value?(d(),y(n,{key:0,label:"\u7528\u6237\u540D",prop:"username"},{default:a(()=>[e(m,{value:t.value.username,disabled:""},null,8,["value"])]),_:1})):_("",!0),o.value?(d(),y(n,{key:1,label:"\u5BC6\u7801",prop:"password"},{default:a(()=>[e(m,{value:t.value.password,"onUpdate:value":l[0]||(l[0]=s=>t.value.password=s),type:"password",placeholder:"\u8BF7\u8F93\u5165\uFF08\u7559\u7A7A\u5219\u4E0D\u4FEE\u6539\uFF09"},null,8,["value"])]),_:1})):_("",!0),e(n,{label:"\u771F\u5B9E\u59D3\u540D",prop:"real_name"},{default:a(()=>[e(m,{value:t.value.real_name,"onUpdate:value":l[1]||(l[1]=s=>t.value.real_name=s)},null,8,["value"])]),_:1}),e(n,{label:"\u90AE\u7BB1",prop:"email"},{default:a(()=>[e(m,{value:t.value.email,"onUpdate:value":l[2]||(l[2]=s=>t.value.email=s)},null,8,["value"])]),_:1}),e(n,{label:"\u5934\u50CF",prop:"avatar"},{default:a(()=>[e(m,{value:t.value.avatar,"onUpdate:value":l[3]||(l[3]=s=>t.value.avatar=s)},null,8,["value"])]),_:1}),o.value?(d(),y(n,{key:2,label:"\u7BA1\u7406\u5458\u6743\u9650",name:"permissions"},{default:a(()=>[e(N,{value:t.value.permissions,"onUpdate:value":l[4]||(l[4]=s=>t.value.permissions=s),options:v(j)},null,8,["value","options"])]),_:1})):_("",!0),e(n,null,{default:a(()=>[e(A,null,{default:a(()=>[e(g,{type:"primary",onClick:O,size:"large"},{default:a(()=>[f(" \u4FDD\u5B58 ")]),_:1}),o.value?(d(),y(S,{key:0,onPositiveClick:T},{trigger:a(()=>[e(g,{type:"error",size:"large"},{default:a(()=>[f(" \u5220\u9664\u7528\u6237 ")]),_:1})]),default:a(()=>[f(" \u60A8\u786E\u8BA4\u8981\u5220\u9664\u7528\u6237 "+E(t.value.username)+" \u5417\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002 ",1)]),_:1})):_("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),o.value?_("",!0):(d(),y(C,{key:0})),o.value?_("",!0):(d(),x("div",se,[te,e(h,{model:r.value,rules:$.value,"label-width":80,style:{"max-width":"min(100%, 500px)"}},{default:a(()=>[e(n,{label:"\u65E7\u5BC6\u7801",name:"old_password"},{default:a(()=>[e(m,{value:r.value.old_password,"onUpdate:value":l[5]||(l[5]=s=>r.value.old_password=s),type:"password"},null,8,["value"])]),_:1}),e(n,{label:"\u65B0\u5BC6\u7801",name:"new_password"},{default:a(()=>[e(m,{value:r.value.new_password,"onUpdate:value":l[6]||(l[6]=s=>r.value.new_password=s),type:"password"},null,8,["value"])]),_:1}),e(n,{label:"\u786E\u8BA4\u5BC6\u7801",name:"confirm_password"},{default:a(()=>[e(m,{value:r.value.confirm_password,"onUpdate:value":l[7]||(l[7]=s=>r.value.confirm_password=s),type:"password"},null,8,["value"])]),_:1}),e(n,null,{default:a(()=>[e(g,{type:"error",onClick:q},{default:a(()=>[f(" \u4FEE\u6539 ")]),_:1})]),_:1})]),_:1},8,["model","rules"])])),e(C),o.value?_("",!0):(d(),x("div",ne,[oe,ue,e(h,{model:p.value,"label-width":80,style:{"max-width":"min(100%, 500px)"}},{default:a(()=>[e(n,{label:"\u4E3B\u9898",name:"theme"},{default:a(()=>[e(U,{value:p.value.theme,"onUpdate:value":l[8]||(l[8]=s=>p.value.theme=s),options:v(G),style:{"min-width":"125px"}},null,8,["value","options"])]),_:1}),e(n,{label:"MarkDown \u4E3B\u9898",name:"markdownTheme"},{default:a(()=>[e(U,{value:p.value.markdownTheme,"onUpdate:value":l[9]||(l[9]=s=>p.value.markdownTheme=s),options:v(H),style:{"min-width":"125px"}},null,8,["value","options"])]),_:1}),e(n,{label:"\u53E5\u5B50API\u63A5\u53E3",name:"sentenceApi"},{default:a(()=>[e(U,{value:p.value.sentenceApi,"onUpdate:value":l[10]||(l[10]=s=>p.value.sentenceApi=s),options:v(J),style:{"min-width":"125px"}},null,8,["value","options"])]),_:1}),e(n,{label:"\u9ED8\u8BA4\u63D0\u4EA4\u8BED\u8A00",name:"defaultSubmitLanguage"},{default:a(()=>[e(U,{value:p.value.defaultSubmitLanguage,"onUpdate:value":l[11]||(l[11]=s=>p.value.defaultSubmitLanguage=s),options:[{label:`\u8DDF\u968F\u4E0A\u6B21\u63D0\u4EA4\uFF08${v(D).languages[v(i).state.lastSubmitLanguage]}\uFF09`,value:"__last__"}].concat(v(Q)),style:{"min-width":"125px"}},null,8,["value","options"])]),_:1}),e(n,null,{default:a(()=>[e(A,null,{default:a(()=>[e(g,{type:"primary",onClick:B},{default:a(()=>[f(" \u4FDD\u5B58 ")]),_:1}),e(S,{onPositiveClick:F},{trigger:a(()=>[e(g,{type:"warning"},{default:a(()=>[f(" \u91CD\u7F6E ")]),_:1})]),default:a(()=>[f(" \u60A8\u786E\u8BA4\u8981\u91CD\u7F6E\u9875\u9762\u8BBE\u7F6E\u4E3A\u7AD9\u70B9\u9ED8\u8BA4\u503C\u5417\uFF1F ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]))],64)}}};export{ke as default};
