import{z as V,y as A,r as i,A as m,o as h,G as E,m as r,n,w as s,Q as P,aA as U,C as p,t as y,J as u,l as k,D as w,L as D,E as I}from"./index.eb4377b0.1766986584207.js";import{M as q}from"./MdEditor.164db853.1766986584207.js";import{_ as F}from"./Divider.97fa3e74.1766986584207.js";import{_ as G}from"./Input.4c626101.1766986584207.js";import{_ as J}from"./Select.324054db.1766986584207.js";import{_ as L}from"./Popconfirm.e2002990.1766986584207.js";import"./Eye.1e3444f4.1766986584207.js";import"./Tag.ff1efa14.1766986584207.js";const Q=r("h2",null,"\u9898\u5355\u540D\u79F0",-1),R=r("h2",null,"\u9898\u5355\u63CF\u8FF0",-1),T=r("h2",null,"\u9898\u76EE\u5217\u8868",-1),le={__name:"edit",setup(j){const C=V(),v=A(),l=C.params.id,a=i({problem_list_mode:!0,problems:[],users:[],title:"",description:"",is_hidden:!1,allow_sign_up:!0}),f=i([Math.floor(Date.now()/36e5)*36e5,Math.floor(Date.now()/36e5)*36e5+864e5]),d=i([]),g=i(!1),x=e=>{if(!e){d.value=[];return}g.value=!0,m.get("/problem/",{params:{search:e}}).then(t=>{t=t.results,d.value=t.map(o=>({label:`#${o.id} | ${o.title}`,value:o.id}))}).finally(()=>{g.value=!1})},z=i([]);i(!1),l&&m.get(`/contest/${l}/`).then(e=>{d.value=e.problems.map(t=>({label:`#${t.id} | ${t.title}`,value:t.id})),e.problems=e.problems.map(t=>t.id),z.value=e.users.map(t=>({label:t.username,value:t.id})),e.start_time=e.start_time&&Number(new Date(e.start_time))||0,e.end_time=e.end_time&&Number(new Date(e.end_time))||0,f.value=[e.start_time,e.end_time],e.users=e.users.map(t=>t.id),a.value=e});const c=i(!1),N=()=>{const e=a.value;if(e.start_time=f.value[0],e.end_time=f.value[1],!e.title){v.warning("\u9898\u5355\u6807\u9898\u4E0D\u80FD\u4E3A\u7A7A");return}e.start_time=e.start_time&&new Date(e.start_time).toISOString()||null,e.end_time=e.end_time&&new Date(e.end_time).toISOString()||null,e.problem_list_mode&&(e.is_hidden=!1),c.value=!0;let t;l?t=m.put(`/contest/${l}/`,e):t=m.post("/contest/",e),t.then(o=>{l?v.success("\u4FEE\u6539\u6210\u529F"):w.push({name:"problemset_detail",params:{id:o.id}})}).finally(()=>{c.value=!1})},S=()=>{m.delete(`/contest/${l}/`).then(()=>{v.success("\u5220\u9664\u6210\u529F\uFF01"),w.push({name:"problemset_list"})})};return(e,t)=>{const o=I,b=U,$=F,M=G,B=J,O=L;return h(),E(P,null,[r("h1",null,[n(b,{style:{"align-items":"center"},size:"large"},{default:s(()=>[p(y(u(l)?"\u7F16\u8F91":"\u521B\u5EFA")+"\u9898\u5355 "+y(u(l)?` #${u(l)}`:"")+" ",1),u(l)?(h(),k(o,{key:0,onClick:t[0]||(t[0]=_=>u(w).push({name:"problemset_detail",params:{id:u(l)}})),style:{display:"flex","align-items":"center"}},{default:s(()=>[p(" \u8FD4\u56DE ")]),_:1})):D("",!0)]),_:1})]),n($),n(b,{vertical:"",size:"large"},{default:s(()=>[r("div",null,[Q,n(M,{value:a.value.title,"onUpdate:value":t[1]||(t[1]=_=>a.value.title=_),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",size:"large"},null,8,["value"])]),r("div",null,[R,n(q,{content:a.value.description,"onUpdate:content":t[2]||(t[2]=_=>a.value.description=_)},null,8,["content"])]),r("div",null,[T,n(B,{value:a.value.problems,"onUpdate:value":t[3]||(t[3]=_=>a.value.problems=_),multiple:"",filterable:"",placeholder:"\u641C\u7D22\u9898\u76EE",options:d.value,loading:g.value,clearable:"",remote:"","clear-filter-after-select":!0,onSearch:x},null,8,["value","options","loading"])])]),_:1}),n($),n(b,null,{default:s(()=>[n(o,{type:"primary",size:"large",onClick:N,loading:c.value,disabled:c.value},{default:s(()=>[p(" \u4FDD\u5B58 ")]),_:1},8,["loading","disabled"]),u(l)?(h(),k(O,{key:0,onPositiveClick:S},{trigger:s(()=>[n(o,{type:"error",size:"large"},{default:s(()=>[p(" \u5220\u9664 ")]),_:1})]),default:s(()=>[p(" \u60A8\u786E\u8BA4\u8981\u5220\u9664\u9898\u5355 "+y(a.value.title)+" \u5417\uFF1F\u8BE5\u64CD\u4F5C\u4E0D\u53EF\u64A4\u9500\u3002 ",1)]),_:1})):D("",!0)]),_:1})],64)}}};export{le as default};
