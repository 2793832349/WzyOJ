import{ay as J,y as P,o as R,l as q,w as n,n as t,k as p,E as T,az as V,aA as I,s as y,A as C,z as M,r as g,a0 as G,aB as H,aC as W,m as N,B as X,C as k,J as D,L as Y,aD as Z}from"./index.eb4377b0.1766986584207.js";import{u as ee}from"./composables.9a9fc0f9.1766986584207.js";import{_ as se}from"./Avatar.3a7b3a89.1766986584207.js";import{_ as A}from"./Tag.ff1efa14.1766986584207.js";import{_ as K}from"./Select.324054db.1766986584207.js";import{_ as te,a as ne}from"./DataTable.8d4e61d5.1766986584207.js";import{_ as ae}from"./Spin.3ae5ee7d.1766986584207.js";import{_ as oe}from"./utils.2f0dea37.1766986584207.js";import{A as le}from"./AddOutline.cf6c0ed3.1766986584207.js";import{_ as re}from"./Input.4c626101.1766986584207.js";import{_ as ue}from"./FormItem.d0d13dbd.1766986584207.js";import{_ as ie}from"./Form.f0be8e2f.1766986584207.js";import{_ as pe}from"./LayoutContent.6fc7b93d.1766986584207.js";import"./utils.83ed917f.1766986584207.js";import"./Eye.1e3444f4.1766986584207.js";import"./ArrowDown.1ae467bd.1766986584207.js";import"./Checkbox.7ca0c7f4.1766986584207.js";import"./RadioGroup.668f9840.1766986584207.js";import"./Tooltip.2d4fe76d.1766986584207.js";import"./Forward.bac4cf6f.1766986584207.js";const _e={__name:"UserTable",props:{data:{type:Array,default:[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup($,{emit:c}){const a=P(),m=ee(),w=[{label:"\u5B66\u751F",value:"student"},{label:"\u6559\u5E08",value:"teacher"},{label:"\u7BA1\u7406\u5458",value:"admin"}],b=e=>e.is_superuser||e.is_staff?"admin":!e.permissions||e.permissions.length===0?"student":e.permissions.includes("site_setting")||e.permissions.includes("user")||e.permissions.includes("submission")||e.permissions.includes("discussion")?"admin":e.permissions.includes("problem")||e.permissions.includes("contest")?"teacher":"student",f=e=>{switch(e){case"admin":return["site_setting","user","problem","submission","discussion","contest"];case"teacher":return["problem","contest"];case"student":default:return[]}},r=(e,u)=>{const _=f(u);C.patch(`/user/${e}/`,{permissions:_}).then(()=>{a.success("\u89D2\u8272\u66F4\u65B0\u6210\u529F"),c("refresh")}).catch(i=>{var l,s;a.error(((s=(l=i.response)==null?void 0:l.data)==null?void 0:s.error)||"\u89D2\u8272\u66F4\u65B0\u5931\u8D25")})},h=(e,u,_)=>{const i=u?"\u5C01\u7981":"\u89E3\u5C01";m[u?"warning":"success"]({title:`${i}\u7528\u6237`,content:`\u786E\u5B9A\u8981${i}\u7528\u6237 "${_}" \u5417\uFF1F`,positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>new Promise((s,x)=>{C.post(`/user/${e}/toggle-active/`).then(()=>{a.success(`${i}\u6210\u529F`),c("refresh"),s()}).catch(d=>{var v,z;a.error(((z=(v=d.response)==null?void 0:v.data)==null?void 0:z.error)||`${i}\u5931\u8D25`),x()})})})},U=()=>y.state.user.is_superuser||y.state.user.is_staff||y.state.user.permissions&&(y.state.user.permissions.includes("user")||y.state.user.permissions.includes("site_setting")),S=[{title:"ID",render(e){return p(V,{to:{name:"user_detail",params:{id:e.id}}},{default:()=>p(T,{text:!0,size:"small"},{default:()=>e.id})})}},{title:"\u7528\u6237\u540D",render(e){return p(V,{to:{name:"user_detail",params:{id:e.id}}},{default:()=>p(I,{style:{display:"inline-flex"}},{default:()=>[e.avatar?p(se,{src:e.avatar,size:"small",round:!0}):null,p(T,{text:!0,size:"small",style:{marginTop:"6px"}},{default:()=>e.username})]})})}},{title:"\u89D2\u8272",render(e){const u=b(e),_=u==="admin"?"\u7BA1\u7406\u5458":u==="teacher"?"\u6559\u5E08":"\u5B66\u751F";return p(A,{type:u==="admin"?"error":u==="teacher"?"success":"info",size:"small"},{default:()=>_})}},{title:"\u72B6\u6001",render(e){return e.is_active?p(A,{type:"success",size:"small"},{default:()=>"\u6B63\u5E38"}):p(A,{type:"error",size:"small"},{default:()=>"\u5DF2\u5C01\u7981"})}},{title:"\u64CD\u4F5C",render(e){return U()?e.id===y.state.user.id?p("span",{style:"color: #999"},"\u5F53\u524D\u7528\u6237"):p(I,{},{default:()=>[p(K,{value:b(e),options:w,size:"small",style:"width: 100px",onUpdateValue:u=>r(e.id,u)}),p(T,{size:"small",type:e.is_active?"warning":"success",disabled:e.is_superuser,onClick:()=>h(e.id,e.is_active,e.username)},{default:()=>e.is_active?"\u5C01\u7981":"\u89E3\u5C01"})]}):null}}];return(e,u)=>{const _=te,i=ae;return R(),q(i,{show:$.loading},{default:n(()=>[t(_,{columns:S,data:$.data,bordered:!1},null,8,["data"])]),_:1},8,["show"])}}},ce=J(_e,[["__scopeId","data-v-b06fda1b"]]),de=N("h1",null,"\u7528\u6237\u5217\u8868",-1),me={style:{display:"inline-block"}},fe={style:{"margin-top":"30px","text-align":"center"}},Ve={__name:"index",setup($){const c=M(),a=g({pageSize:20,page:1,count:0}),m=g(""),w=g([]),b=g(!1),f=g(!1),r=g({username:"",password:"",role:"student"}),h=g(!1),U=P(),S=[{label:"\u5B66\u751F",value:"student"},{label:"\u6559\u5E08",value:"teacher"},{label:"\u7BA1\u7406\u5458",value:"admin"}],e=l=>{switch(l){case"admin":return["site_setting","user","problem","submission","discussion","contest"];case"teacher":return["problem","contest"];case"student":default:return[]}},u=()=>{if(!r.value.username||!r.value.password){U.error("\u7528\u6237\u540D\u6216\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A");return}h.value=!0,C.post("/user/",{username:r.value.username,password:r.value.password,permissions:e(r.value.role)}).then(()=>{U.success("\u521B\u5EFA\u6210\u529F"),f.value=!1,r.value={username:"",password:"",role:"student"},i()}).finally(()=>{h.value=!1})},_=()=>{const l={search:m.value};oe(l,a.value,c)()},i=()=>{if(c.name==="user_list"){c.query.search&&(m.value=c.query.search);for(const l in a.value)c.query[l]&&(a.value[l]=parseInt(c.query[l]));b.value=!0,C.get("/user/",{params:{limit:a.value.pageSize,offset:(a.value.page-1)*a.value.pageSize,search:m.value}}).then(l=>{a.value.count=l.count,w.value=l.results}).finally(()=>{b.value=!1})}};return G(()=>c.query,i),i(),(l,s)=>{const x=re,d=ue,v=T,z=ie,L=H,B=pe,O=ne,Q=K,j=I,E=Z,F=W;return R(),q(F,null,{default:n(()=>[de,t(B,null,{default:n(()=>[N("div",me,[t(z,{inline:""},{default:n(()=>[t(d,{label:"\u7528\u6237ID/\u540D\u79F0"},{default:n(()=>[t(x,{value:m.value,"onUpdate:value":s[0]||(s[0]=o=>m.value=o),onKeydown:X(_,["enter"])},null,8,["value","onKeydown"])]),_:1}),t(d,null,{default:n(()=>[t(v,{type:"primary",onClick:_},{default:n(()=>[k("\u641C\u7D22")]),_:1})]),_:1})]),_:1})]),D(y).state.user.permissions.includes("user")?(R(),q(v,{key:0,style:{float:"right","margin-top":"25px"},type:"primary",onClick:s[1]||(s[1]=o=>f.value=!0)},{icon:n(()=>[t(L,{component:D(le)},null,8,["component"])]),default:n(()=>[k(" \u521B\u5EFA\u7528\u6237 ")]),_:1})):Y("",!0)]),_:1}),t(B,null,{default:n(()=>[t(ce,{data:w.value,loading:b.value,onRefresh:i},null,8,["data","loading"])]),_:1}),t(B,null,{default:n(()=>[N("div",fe,[t(O,{page:a.value.page,"onUpdate:page":[s[2]||(s[2]=o=>a.value.page=o),_],"page-size":a.value.pageSize,"onUpdate:pageSize":[s[3]||(s[3]=o=>a.value.pageSize=o),s[4]||(s[4]=o=>{a.value.pageSize=o,a.value.page=1,_()})],"item-count":a.value.count,"show-size-picker":"","show-quick-jumper":"","page-sizes":[10,20,50]},null,8,["page","page-size","item-count"])])]),_:1}),t(E,{show:f.value,"onUpdate:show":s[9]||(s[9]=o=>f.value=o),preset:"card",title:"\u521B\u5EFA\u7528\u6237",style:{width:"min(92vw, 420px)"}},{default:n(()=>[t(z,null,{default:n(()=>[t(d,{label:"\u521D\u59CB\u89D2\u8272"},{default:n(()=>[t(Q,{value:r.value.role,"onUpdate:value":s[5]||(s[5]=o=>r.value.role=o),options:S},null,8,["value"])]),_:1}),t(d,{label:"\u7528\u6237\u540D"},{default:n(()=>[t(x,{value:r.value.username,"onUpdate:value":s[6]||(s[6]=o=>r.value.username=o)},null,8,["value"])]),_:1}),t(d,{label:"\u5BC6\u7801"},{default:n(()=>[t(x,{value:r.value.password,"onUpdate:value":s[7]||(s[7]=o=>r.value.password=o),type:"password"},null,8,["value"])]),_:1}),t(d,null,{default:n(()=>[t(j,null,{default:n(()=>[t(v,{type:"primary",loading:h.value,onClick:u},{default:n(()=>[k("\u521B\u5EFA")]),_:1},8,["loading"]),t(v,{onClick:s[8]||(s[8]=o=>f.value=!1),disabled:h.value},{default:n(()=>[k("\u53D6\u6D88")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})}}};export{Ve as default};
