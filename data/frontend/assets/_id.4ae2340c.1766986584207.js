import{ay as G,z as H,y as J,r as u,bH as K,o as s,G as g,m as f,t as k,n as e,w as n,Q as z,bI as O,L as v,A as x,E as Q,l as b,C as c,bJ as X,bK as q,aA as W,_ as Y}from"./index.eb4377b0.1766986584207.js";import{C as Z}from"./ContestTable.e4672b41.1766986584207.js";import{P as ee}from"./ProblemTable.6d141f6b.1766986584207.js";import{M as E}from"./MdEditor.164db853.1766986584207.js";import{_ as te}from"./captcha.18127446.1766986584207.js";import{_ as ne}from"./ButtonGroup.37583538.1766986584207.js";import{_ as oe,a as ae}from"./CollapseItem.5cda8d00.1766986584207.js";import{_ as le}from"./Divider.97fa3e74.1766986584207.js";import{_ as se}from"./Avatar.3a7b3a89.1766986584207.js";import{_ as ce}from"./Time.2d3501e9.1766986584207.js";import"./consts.72579ead.1766986584207.js";import"./CheckCircleTwotone.04f14e2a.1766986584207.js";import"./Tag.ff1efa14.1766986584207.js";import"./Eye.1e3444f4.1766986584207.js";import"./DataTable.8d4e61d5.1766986584207.js";import"./ArrowDown.1ae467bd.1766986584207.js";import"./Checkbox.7ca0c7f4.1766986584207.js";import"./RadioGroup.668f9840.1766986584207.js";import"./Input.4c626101.1766986584207.js";import"./Tooltip.2d4fe76d.1766986584207.js";import"./Select.324054db.1766986584207.js";import"./Forward.bac4cf6f.1766986584207.js";import"./Spin.3ae5ee7d.1766986584207.js";import"./FormItem.d0d13dbd.1766986584207.js";import"./utils.83ed917f.1766986584207.js";import"./index.225da447.1766986584207.js";const I=h=>(X("data-v-dc429c01"),h=h(),q(),h),re={key:0},ue={key:0,style:{display:"flex","justify-content":"center",margin:"2rem 0"}},_e=I(()=>f("h2",null,"\u65B0\u56DE\u590D",-1)),ie=I(()=>f("p",null,"\u7B2C\u4E00\u884C\u201CReply to #X\u201D\u683C\u5F0F\u7684\u5185\u5BB9\u4F1A\u5728\u53D1\u5E03\u65F6\u81EA\u52A8\u8F6C\u4E49\u548C\u6D88\u53BB\u3002",-1)),pe=I(()=>f("p",null,"\u6682\u4E0D\u652F\u6301@\u7528\u6237\u3002",-1)),de={__name:"_id",setup(h){const S=H(),$=J(),C=S.params.id,r=u({});(()=>{x.get(`/discussion/${C}/`).then(a=>{r.value=a})})();let y=1;const _=u([]),i=u(!1),p=u(!1),w=()=>{i.value||p.value||(i.value=!0,x.get(`/discussion/${C}/reply/?page=${y}`).then(a=>{var l;for(;a[0].id<=((l=_.value[_.value.length-1])==null?void 0:l.id);)a.shift();_.value.push(...a),y++}).catch(a=>{a.status===404&&(p.value=!0)}).finally(()=>{i.value=!1}))};w();const o=u({content:"",reply_to:null,captcha:""}),R=u(null),D=(a,l=!0)=>{const d=o.value.content.match(/^Reply to #\d+\n+/);d&&(o.value.content=o.value.content.replace(d[0],"")),o.value.content.trimStart(),o.value.content=`Reply to #${a}

${o.value.content}`,l&&document.getElementById("new-reply").scrollIntoView()},M=async()=>{const a=o.value.content.match(/^Reply to #(\d+)\n+/);a&&(o.value.reply_to=parseInt(a[1]),o.value.content=o.value.content.replace(a[0],"")),await R.value.checkCaptcha()&&x.post(`/discussion/${C}/reply/`,o.value).then(()=>{$.success("\u56DE\u590D\u6210\u529F"),o.value.content="",y!==1&&y--,p.value=!1,w()}).catch(l=>{$.error(l.response.data)})},N=a=>{const l=document.getElementById(`reply-card-${a}`);l?l.scrollIntoView():$.error("\u627E\u4E0D\u5230\u539F\u8D34")};return(a,l)=>{const d=ae,T=oe,B=le,A=se,L=W,V=K("router-link"),P=ce,m=Q,U=ne,j=Y;return s(),g(z,null,[f("h1",null,k(r.value.title),1),e(T,null,{default:n(()=>[r.value.related_problem?(s(),b(d,{key:0,title:"\u5173\u8054\u95EE\u9898",name:"related_problem"},{default:n(()=>[e(ee,{data:[r.value.related_problem]},null,8,["data"])]),_:1})):v("",!0),r.value.related_contest?(s(),b(d,{key:1,title:"\u5173\u8054\u6BD4\u8D5B",name:"related_contest"},{default:n(()=>[e(Z,{data:[r.value.related_contest]},null,8,["data"])]),_:1})):v("",!0)]),_:1}),e(B),(s(!0),g(z,null,O(_.value,t=>(s(),b(j,{class:"reply",key:t.id,id:`reply-card-${t.id}`,embedded:"",segmented:{content:"soft",action:!0}},{header:n(()=>[e(V,{to:{name:"user_detail",params:{id:t.author.id}},class:"reply-header"},{default:n(()=>[e(L,null,{default:n(()=>[t.author.avatar?(s(),b(A,{key:0,src:t.author.avatar,size:"small",round:""},null,8,["src"])):v("",!0),c(" "+k(t.author.username),1)]),_:2},1024)]),_:2},1032,["to"])]),"header-extra":n(()=>[e(P,{time:new Date(t.create_time)},null,8,["time"])]),footer:n(()=>[t.reply_to?(s(),g("div",re,[c(" \u56DE\u590D\u7ED9 "),e(V,{to:{name:"user_detail",params:{id:t.reply_to.author.id}}},{default:n(()=>[e(m,{text:""},{default:n(()=>[c(" @"+k(t.reply_to.author.username),1)]),_:2},1024)]),_:2},1032,["to"]),c(" \uFF0C "),e(m,{text:"",onClick:F=>N(t.reply_to.id)},{default:n(()=>[c(" \u67E5\u770B\u539F\u8D34 ")]),_:2},1032,["onClick"])])):v("",!0)]),action:n(()=>[e(U,{size:"small"},{default:n(()=>[e(m,{onClick:F=>D(t.id)},{default:n(()=>[c("\u56DE\u590D")]),_:2},1032,["onClick"])]),_:2},1024)]),default:n(()=>[e(E,{content:t.content,previewOnly:""},null,8,["content"])]),_:2},1032,["id"]))),128)),_.value.length?(s(),g("div",ue,[e(m,{size:"large",loading:i.value,disabled:i.value||p.value,onClick:w},{default:n(()=>[c(k(p.value?"\u52A0\u8F7D\u5B8C\u6210":"\u52A0\u8F7D\u66F4\u591A"),1)]),_:1},8,["loading","disabled"])])):v("",!0),e(B),f("div",null,[_e,ie,pe,e(E,{content:o.value.content,"onUpdate:content":l[0]||(l[0]=t=>o.value.content=t)},null,8,["content"]),e(te,{scene:"discussion",captcha:o.value.captcha,"onUpdate:captcha":l[1]||(l[1]=t=>o.value.captcha=t),ref_key:"captchaRef",ref:R},null,8,["captcha"]),e(m,{id:"new-reply",type:"primary",size:"large",onClick:M,style:{margin:"1.5rem 0"}},{default:n(()=>[c(" \u53D1\u5E03 ")]),_:1})])],64)}}},je=G(de,[["__scopeId","data-v-dc429c01"]]);export{je as default};
