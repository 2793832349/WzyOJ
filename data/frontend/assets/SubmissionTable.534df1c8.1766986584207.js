import{ay as x,y,r as z,a0 as I,aW as S,e as T,s as _,k as t,E as r,o as C,l as j,w as k,n as D,A as N,az as u,H as A}from"./index.eb4377b0.1766986584207.js";import{f as B,a as E}from"./utils.2f0dea37.1766986584207.js";import{j as o,n as G,a as P}from"./consts.72579ead.1766986584207.js";import{_ as M}from"./Time.2d3501e9.1766986584207.js";import{_ as R}from"./DataTable.8d4e61d5.1766986584207.js";import{_ as U}from"./Spin.3ae5ee7d.1766986584207.js";const $={__name:"SubmissionTable",props:{data:{type:Array,default:[]},loading:{type:Boolean,default:!1}},emits:["refresh"],setup(d,{emit:c}){const p=d,f=y(),a=z(new Set);let l=null;const m=()=>{l&&(clearInterval(l),l=null)},g=()=>{l||(l=setInterval(()=>{c("refresh",!0)},2e3))};I(()=>p.data,s=>{if(a.value.size===0)return;const e=[];for(const n of a.value){const i=s.find(h=>h.id===n);(!i||i.status!==o.PENDING&&i.status!==o.JUDGING)&&e.push(n)}e.forEach(n=>a.value.delete(n)),a.value.size===0&&m()},{deep:!0}),S(()=>{m(),a.value.clear()});const b=s=>{N.post(`/submission/${s}/rejudge/`).then(()=>{f.success("\u5DF2\u5F00\u59CB\u91CD\u65B0\u8BC4\u6D4B"),a.value.add(s),g(),c("refresh"),setTimeout(()=>{a.value.has(s)&&(a.value.delete(s),a.value.size===0&&m())},12e4)})},v=T(()=>{const s=[{title:"ID",render(e){return t(u,{to:{name:"submission_detail",params:{id:e.id}}},{default:()=>t(r,{text:!0,size:"small"},{default:()=>String(e.id)+(e.is_hidden?"*":"")})})}},{title:"\u5206\u6570",render(e){return t(u,{to:{name:"submission_detail",params:{id:e.id}}},{default:()=>t(r,{text:!0,size:"small",color:o.getColorClass(e.status)},{default:()=>e.score})})}},{title:"\u72B6\u6001",render(e){return t(u,{to:{name:"submission_detail",params:{id:e.id}}},{default:()=>t(r,{size:"small",color:o.getColorClass(e.status)},{default:()=>o.getDisplay(e.status)})})}},{title:"\u9898\u76EE",render(e){return t(u,{to:{name:"problem_detail",params:{id:e.problem.id}}},{default:()=>t(r,{text:!0,size:"small"},{default:()=>e.problem.title})})}},{title:"\u7528\u6237",render(e){return t(u,{to:{name:"user_detail",params:{id:e.user.id}}},{default:()=>t(r,{text:!0,size:"small"},{default:()=>e.user.username})})}},{title:"\u7528\u65F6",render(e){return G.includes(e.status)?"-":B(e.execute_time)}},{title:"\u5185\u5B58",render(e){return P.includes(e.status)?"-":E(e.execute_memory)}},{title:"\u8BED\u8A00",render(e){return A.languages[e.language]}},{title:"\u63D0\u4EA4\u65F6\u95F4",render(e){return t(M,{time:new Date(e.create_time)})}}];return _.state.user.permissions&&_.state.user.permissions.includes("submission")&&s.push({title:"\u64CD\u4F5C",render(e){return t(r,{size:"small",type:"warning",onClick:()=>b(e.id)},{default:()=>"\u91CD\u65B0\u8BC4\u6D4B"})}}),s});return(s,e)=>{const n=R,i=U;return C(),j(i,{show:d.loading},{default:k(()=>[D(n,{columns:v.value,data:d.data,bordered:!1},null,8,["columns","data"])]),_:1},8,["show"])}}},K=x($,[["__scopeId","data-v-5cd72737"]]);export{K as S};
