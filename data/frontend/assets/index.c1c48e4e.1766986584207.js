import{y as Y,r as f,e as P,F as Z,o as i,G as D,m as E,n as e,w as t,A as $,aA as ee,aD as te,l as v,C as n,L as m,Q as G,bI as Q,t as r,cC as S,E as le,_ as ne}from"./index.eb4377b0.1766986584207.js";import{u as ae}from"./composables.9a9fc0f9.1766986584207.js";import{a as oe,_ as se}from"./Tabs.ad385494.1766986584207.js";import{_ as ue}from"./text.10f0e60f.1766986584207.js";import{_ as ie,a as re}from"./Tag.ff1efa14.1766986584207.js";import{_ as de}from"./Divider.97fa3e74.1766986584207.js";import{_ as _e}from"./Input.4c626101.1766986584207.js";import{_ as pe}from"./FormItem.d0d13dbd.1766986584207.js";import{_ as ce}from"./Switch.f34fe457.1766986584207.js";import{_ as fe}from"./Form.f0be8e2f.1766986584207.js";import"./Add.3491e10c.1766986584207.js";import"./Eye.1e3444f4.1766986584207.js";const ve=E("span",null,"\u6211\u7684\u73ED\u7EA7",-1),me=["onClick"],je={__name:"index",setup(ge){const _=Y(),H=ae(),x=f([]),y=f(!1),C=f(!1),U=f(!1),z=f(!1),M=f("joined"),p=f({title:"",description:"",is_hidden:!1}),T=f(null),c=f({title:"",description:"",is_hidden:!1}),j=P(()=>x.value.filter(s=>s.user_role==="teacher")),N=P(()=>x.value.filter(s=>s.user_role==="student")),J=f(!0),k=()=>{$.get("class/class/").then(s=>{x.value=s,s.some(d=>d.user_role==="teacher")&&(M.value="teaching")}).catch(()=>{_.error("\u83B7\u53D6\u73ED\u7EA7\u5217\u8868\u5931\u8D25")})},K=s=>{T.value=s.id,c.value={title:s.title||"",description:s.description||"",is_hidden:!!s.is_hidden},C.value=!0},O=()=>{if(!T.value){_.error("\u73ED\u7EA7\u4FE1\u606F\u5F02\u5E38");return}if(!c.value.title){_.warning("\u8BF7\u8F93\u5165\u73ED\u7EA7\u540D\u79F0");return}z.value=!0,$.patch(`class/class/${T.value}/`,c.value).then(()=>{_.success("\u4FDD\u5B58\u6210\u529F"),C.value=!1,k()}).catch(()=>{_.error("\u4FDD\u5B58\u5931\u8D25")}).finally(()=>{z.value=!1})},R=()=>{if(!p.value.title){_.warning("\u8BF7\u8F93\u5165\u73ED\u7EA7\u540D\u79F0");return}U.value=!0,$.post("class/class/",p.value).then(()=>{_.success("\u521B\u5EFA\u6210\u529F"),y.value=!1,p.value={title:"",description:"",is_hidden:!1},k()}).catch(()=>{_.error("\u521B\u5EFA\u5931\u8D25")}).finally(()=>{U.value=!1})},W=s=>{H.error({title:"\u89E3\u6563\u73ED\u7EA7",content:`\u786E\u5B9A\u8981\u89E3\u6563\u73ED\u7EA7 "${s.title}" \u5417\uFF1F\u89E3\u6563\u540E\u6240\u6709\u6210\u5458\u5C06\u88AB\u79FB\u9664\uFF0C\u4E14\u73ED\u7EA7\u4E0D\u53EF\u6062\u590D\uFF01`,positiveText:"\u786E\u5B9A\u89E3\u6563",negativeText:"\u53D6\u6D88",onPositiveClick:()=>new Promise((a,d)=>{$.post(`class/class/${s.id}/disband/`).then(()=>{_.success("\u73ED\u7EA7\u5DF2\u89E3\u6563"),k(),a()}).catch(u=>{var o,b;_.error(((b=(o=u.response)==null?void 0:o.data)==null?void 0:b.error)||"\u89E3\u6563\u5931\u8D25"),d()})})})};return Z(()=>{k()}),(s,a)=>{const d=le,u=ee,o=ue,b=ie,g=de,V=ne,A=re,q=se,X=oe,w=_e,h=pe,F=ce,I=fe,L=te;return i(),D("div",null,[E("h1",null,[e(u,{align:"center",size:"large"},{default:t(()=>[ve,J.value?(i(),v(d,{key:0,type:"primary",onClick:a[0]||(a[0]=l=>y.value=!0)},{default:t(()=>[n(" \u521B\u5EFA\u73ED\u7EA7 ")]),_:1})):m("",!0)]),_:1})]),e(X,{type:"line",animated:"",value:M.value,"onUpdate:value":a[1]||(a[1]=l=>M.value=l)},{default:t(()=>[j.value.length>0?(i(),v(q,{key:0,name:"teaching",tab:"\u6211\u521B\u5EFA\u7684\u73ED\u7EA7"},{default:t(()=>[e(u,{vertical:""},{default:t(()=>[(i(!0),D(G,null,Q(j.value,l=>(i(),v(V,{key:l.id,hoverable:"",style:{cursor:"pointer"}},{header:t(()=>[e(u,{align:"center",justify:"space-between"},{default:t(()=>[e(u,{align:"center"},{default:t(()=>[e(o,{strong:"",style:{"font-size":"18px"}},{default:t(()=>[n(r(l.title),1)]),_:2},1024),l.is_hidden?(i(),v(b,{key:0,type:"warning",size:"small"},{default:t(()=>[n("\u9690\u85CF")]),_:1})):m("",!0)]),_:2},1024),e(u,null,{default:t(()=>[e(d,{size:"small",onClick:S(B=>K(l),["stop"])},{default:t(()=>[n(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),e(d,{type:"error",size:"small",onClick:S(B=>W(l),["stop"])},{default:t(()=>[n(" \u89E3\u6563\u73ED\u7EA7 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:t(()=>[E("div",{onClick:B=>s.$router.push({name:"class_detail",params:{id:l.id}})},[e(u,null,{default:t(()=>[e(o,{depth:"3"},{default:t(()=>[n("\u6559\u5E08\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.teacher.username),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u5B66\u751F\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.student_count),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u9898\u76EE\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.problem_count),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u4F5C\u4E1A\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.assignment_count),1)]),_:2},1024)]),_:2},1024),l.description?(i(),v(o,{key:0,depth:"3",style:{"margin-top":"12px",display:"block"}},{default:t(()=>[n(r(l.description),1)]),_:2},1024)):m("",!0)],8,me)]),_:2},1024))),128)),j.value.length===0?(i(),v(A,{key:0,description:"\u6682\u65E0\u73ED\u7EA7"})):m("",!0)]),_:1})]),_:1})):m("",!0),e(q,{name:"joined",tab:"\u6211\u52A0\u5165\u7684\u73ED\u7EA7"},{default:t(()=>[e(u,{vertical:""},{default:t(()=>[(i(!0),D(G,null,Q(N.value,l=>(i(),v(V,{key:l.id,hoverable:"",onClick:B=>s.$router.push({name:"class_detail",params:{id:l.id}}),style:{cursor:"pointer"}},{header:t(()=>[e(o,{strong:"",style:{"font-size":"18px"}},{default:t(()=>[n(r(l.title),1)]),_:2},1024)]),default:t(()=>[e(u,null,{default:t(()=>[e(o,{depth:"3"},{default:t(()=>[n("\u6559\u5E08\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.teacher.username),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u5B66\u751F\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.student_count),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u9898\u76EE\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.problem_count),1)]),_:2},1024),e(g,{vertical:""}),e(o,{depth:"3"},{default:t(()=>[n("\u4F5C\u4E1A\u6570\uFF1A")]),_:1}),e(o,null,{default:t(()=>[n(r(l.assignment_count),1)]),_:2},1024)]),_:2},1024),l.description?(i(),v(o,{key:0,depth:"3",style:{"margin-top":"12px",display:"block"}},{default:t(()=>[n(r(l.description),1)]),_:2},1024)):m("",!0)]),_:2},1032,["onClick"]))),128)),N.value.length===0?(i(),v(A,{key:0,description:"\u6682\u672A\u52A0\u5165\u4EFB\u4F55\u73ED\u7EA7"})):m("",!0)]),_:1})]),_:1})]),_:1},8,["value"]),e(L,{show:y.value,"onUpdate:show":a[6]||(a[6]=l=>y.value=l),preset:"dialog",title:"\u521B\u5EFA\u73ED\u7EA7"},{action:t(()=>[e(u,null,{default:t(()=>[e(d,{onClick:a[5]||(a[5]=l=>y.value=!1)},{default:t(()=>[n("\u53D6\u6D88")]),_:1}),e(d,{type:"primary",onClick:R,loading:U.value},{default:t(()=>[n(" \u521B\u5EFA ")]),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(I,{model:p.value,"label-placement":"left","label-width":"80"},{default:t(()=>[e(h,{label:"\u73ED\u7EA7\u540D\u79F0",required:""},{default:t(()=>[e(w,{value:p.value.title,"onUpdate:value":a[2]||(a[2]=l=>p.value.title=l),placeholder:"\u8BF7\u8F93\u5165\u73ED\u7EA7\u540D\u79F0"},null,8,["value"])]),_:1}),e(h,{label:"\u73ED\u7EA7\u63CF\u8FF0"},{default:t(()=>[e(w,{value:p.value.description,"onUpdate:value":a[3]||(a[3]=l=>p.value.description=l),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u73ED\u7EA7\u63CF\u8FF0",rows:3},null,8,["value"])]),_:1}),e(h,{label:"\u662F\u5426\u9690\u85CF"},{default:t(()=>[e(F,{value:p.value.is_hidden,"onUpdate:value":a[4]||(a[4]=l=>p.value.is_hidden=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),e(L,{show:C.value,"onUpdate:show":a[11]||(a[11]=l=>C.value=l),preset:"dialog",title:"\u7F16\u8F91\u73ED\u7EA7"},{action:t(()=>[e(u,null,{default:t(()=>[e(d,{onClick:a[10]||(a[10]=l=>C.value=!1)},{default:t(()=>[n("\u53D6\u6D88")]),_:1}),e(d,{type:"primary",onClick:O,loading:z.value},{default:t(()=>[n(" \u4FDD\u5B58 ")]),_:1},8,["loading"])]),_:1})]),default:t(()=>[e(I,{model:c.value,"label-placement":"left","label-width":"80"},{default:t(()=>[e(h,{label:"\u73ED\u7EA7\u540D\u79F0",required:""},{default:t(()=>[e(w,{value:c.value.title,"onUpdate:value":a[7]||(a[7]=l=>c.value.title=l),placeholder:"\u8BF7\u8F93\u5165\u73ED\u7EA7\u540D\u79F0"},null,8,["value"])]),_:1}),e(h,{label:"\u73ED\u7EA7\u63CF\u8FF0"},{default:t(()=>[e(w,{value:c.value.description,"onUpdate:value":a[8]||(a[8]=l=>c.value.description=l),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u73ED\u7EA7\u63CF\u8FF0",rows:3},null,8,["value"])]),_:1}),e(h,{label:"\u662F\u5426\u9690\u85CF"},{default:t(()=>[e(F,{value:c.value.is_hidden,"onUpdate:value":a[9]||(a[9]=l=>c.value.is_hidden=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}};export{je as default};
